#!/bin/bash
# OpenVAS vulnerability scan

TARGET="${1:-192.168.1.1}"

echo "Running OpenVAS scan on: $TARGET"

# Install OpenVAS if needed
if ! command -v omp >/dev/null 2>&1; then
    echo "OpenVAS not installed. Install with: apt-get install openvas"
    exit 1
fi

# Create scan task
TASK_ID=$(omp -u admin -w admin --xml="<create_task><name>IoT Device Scan</name><target><hosts>$TARGET</hosts></target><config id='daba56c8-73ec-11ea-a475-08002724e806'/></create_task>" | grep -oP 'id="\K[^"]+')

echo "Task created: $TASK_ID"

# Start scan
omp -u admin -w admin --start-task $TASK_ID

# Wait for completion
echo "Waiting for scan to complete..."
sleep 60

# Get results
omp -u admin -w admin --get-report $TASK_ID --format xml > openvas_report.xml

echo "Scan complete. Report: openvas_report.xml"

