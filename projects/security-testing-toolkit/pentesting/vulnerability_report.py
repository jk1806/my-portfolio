#!/usr/bin/env python3
"""Generate vulnerability report from scan results"""

import sys
import json
import xml.etree.ElementTree as ET
from datetime import datetime

def parse_nmap_results(nmap_file):
    """Parse Nmap XML results"""
    tree = ET.parse(nmap_file)
    root = tree.getroot()
    
    vulnerabilities = []
    for host in root.findall('host'):
        ip = host.find('address').get('addr')
        for port in host.findall('.//port'):
            port_num = port.get('portid')
            state = port.find('state').get('state')
            if state == 'open':
                vulnerabilities.append({
                    'type': 'open_port',
                    'host': ip,
                    'port': port_num,
                    'severity': 'medium'
                })
    
    return vulnerabilities

def generate_report(vulns, output_file):
    """Generate vulnerability report"""
    report = {
        'timestamp': datetime.now().isoformat(),
        'total_vulnerabilities': len(vulns),
        'vulnerabilities': vulns
    }
    
    with open(output_file, 'w') as f:
        json.dump(report, f, indent=2)
    
    print(f"Report generated: {output_file}")
    print(f"Total vulnerabilities: {len(vulns)}")

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print("Usage: vulnerability_report.py <nmap_xml> [output.json]")
        sys.exit(1)
    
    vulns = parse_nmap_results(sys.argv[1])
    output = sys.argv[2] if len(sys.argv) > 2 else 'vulnerability_report.json'
    generate_report(vulns, output)

